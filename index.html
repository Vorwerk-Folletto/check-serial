<script>
    // PASSWORD ACCESS
    const ACCESS_PASSWORD = "1232";
    function checkPassword() {
        const userInput = document.getElementById("passwordInput").value.trim();
        if (userInput === ACCESS_PASSWORD) {
            document.getElementById("passwordOverlay").style.display = "none";
            document.getElementById("mainContent").style.display = "block";
        } else {
            const err = document.getElementById("passwordError");
            err.style.display = "block";
            setTimeout(() => { err.style.display = "none"; }, 2000);
        }
    }

    // CONTATORE CLIENTI
    var n = localStorage.getItem('contatoreFolletto');
    n = n ? parseInt(n) : 3164;
    n++;
    document.getElementById('numeroClienti').textContent = n;
    localStorage.setItem('contatoreFolletto', n);

    // MODELLO & SERIALE LOGIC
    function checkModel() {
        const serial = document.getElementById("serialInput").value.trim();
        const nome = document.getElementById("nomeCliente").value.trim();
        const prefix = serial.substring(0, 2);

        let modello = "", anno = "", imgUrl = "", scaduta = true;

        if (["83","84","85","86","87","88","89","90","91","92","93","94","95","96"].includes(prefix)) {
            modello = "VK 120-122"; anno = "1983-1996"; imgUrl = "IMG_3693.jpg";
        } else if (["97","98","99"].includes(prefix)) {
            modello = "VK 130"; anno = "1997-1999"; imgUrl = "IMG_3692.jpg";
        } else if (["00","01","02"].includes(prefix)) {
            modello = "VK 131"; anno = "2000-2002"; imgUrl = "IMG_3691.jpg";
        } else if (["03","04","05","06","07"].includes(prefix)) {
            modello = "VK 135"; anno = "2003-2007"; imgUrl = "IMG_3690.jpg";
        } else if (["08"].includes(prefix)) {
            modello = "VK 136"; anno = "2008"; imgUrl = "IMG_3689.jpg";
        } else if (["09","10","11","12","13"].includes(prefix)) {
            modello = "VK140"; anno = "2009-2013"; imgUrl = "IMG_3582.jpg";
        } else if (prefix === "14") {
            modello = "VK150"; anno = "2014"; imgUrl = "IMG_3584.jpg";
        } else if (["15","16","17"].includes(prefix)) {
            modello = "VK 200"; anno = "2015-2017"; imgUrl = "IMG_3595.jpg";
        } else if (["18","19","20","21"].includes(prefix)) {
            // ✅ VK220S: usiamo la stessa immagine del VK200 (perché IMG_3597.jpg non c'è)
            modello = "VK 220S"; anno = "2018-2021"; imgUrl = "IMG_3595.jpg";
        } else if (["22","23","24","25"].includes(prefix)) {
            modello = "VK7S"; anno = "2022-2025"; imgUrl = "IMG_3598.jpg"; scaduta = false;
        } else {
            modello = "Modello non riconosciuto"; anno = ""; imgUrl = "";
        }

        // ✅ TESTO INTERVENTO: VK7 diverso dagli altri
        const isVK7 = ["22","23","24","25"].includes(prefix);

        const interventoText = isVK7
            ? "Intervento di manutenzione gratuito disponibile al prodotto:<br>Check batterie e recupero potenza motore"
            : "Intervento di manutenzione gratuito disponibile al prodotto:<br>Ripristino potenza motore";

        // Messaggio assistenza scaduta
        const scadutaDiv = document.getElementById("scaduta-message");
        if (modello !== "Modello non riconosciuto" && scaduta) {
            scadutaDiv.innerHTML = "<div class='warning'>⚠️ Assistenza scaduta! Richiesto intervento urgente.</div>";
            scadutaDiv.style.display = "block";
        } else {
            scadutaDiv.innerHTML = "";
            scadutaDiv.style.display = "none";
        }

        // Output + immagine + ricevuta
        let output = "", appButtonHtml = "";
        const modelImg = document.getElementById("modelImg");

        if (modello !== "Modello non riconosciuto") {
            output = "<span class='ok-message'>" + interventoText + ".</span><br>";
            output += "Modello: <b>" + modello + "</b><br>Anno di produzione: <b>" + anno + "</b>";

            if (imgUrl) {
                modelImg.src = imgUrl;
                modelImg.style.display = "block";
                modelImg.classList.remove('responsive');
            } else {
                modelImg.style.display = "none";
            }

            let ricevuta = "";
            if (nome) ricevuta += "<b>Cliente:</b> " + nome + "<br>";
            ricevuta += "<b>Serial:</b> " + serial + "<br>";
            ricevuta += "<b>Modello:</b> " + modello + "<br>";
            ricevuta += "<b>Anno:</b> " + anno + "<br>";
            ricevuta += "<span style='color:#0b942e;font-weight:bold;'>" + interventoText + ".</span><br>";
            ricevuta += "<div class='promo-bonus'>Prenota <u>ORA</u> la manutenzione e ricevi in omaggio il <span class='tappeto'>lavaggio completo del tuo tappeto</span>!</div>";
            ricevuta += "<div class='note'>Servizio valido solo per prodotti originali Vorwerk Folletto.</div>";

            document.getElementById("ricevuta").innerHTML = ricevuta;
            document.getElementById("ricevuta").style.display = "block";
        } else {
            output = "<span style='color:#b02b2b'>Modello non riconosciuto!<br>Controlla il serial.</span>";
            modelImg.style.display = "none";
            document.getElementById("ricevuta").style.display = "none";
            scadutaDiv.innerHTML = "";
            scadutaDiv.style.display = "none";
        }

        document.getElementById("output").innerHTML = output;
        document.getElementById("appButton").innerHTML = appButtonHtml;
    }

    // **Fase test**: la funzione scansione NON fa nulla
    function scanOCR() {
        alert("Funzione scansione seriale in fase di test. Sarà disponibile a breve!");
    }
</script>